<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devoteam - Radar de Maturité Interactif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f5;
        }
        .devoteam-main { color: #2d2d2d; }
        .devoteam-accent-1 { color: #D94686; }
        .devoteam-bg-accent-1 { background-color: #D94686; }

        .slide-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2.5rem 3rem;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.05), 0 4px 6px -4px rgb(0 0 0 / 0.05);
            border: 1px solid #e2e8f0;
        }
        .slide-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #2d2d2d;
            text-align: center;
            margin-bottom: 2.5rem;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #D94686;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .prose h3 {
            font-size: 1.25em;
            margin-bottom: 0.5em;
            font-weight: bold;
            color: #2d2d2d;
        }
        .prose h3.clickable-axe {
            cursor: pointer;
            text-decoration: underline;
            text-decoration-color: #D94686;
            text-decoration-thickness: 2px;
            display: inline-block;
        }
        .prose h3.clickable-axe:hover {
            color: #D94686;
        }
        .prose ul { margin-top: 0.5em; padding-left: 1.5em; list-style-type: disc; }
        .prose li { margin-bottom: 0.25em; }

        .evaluation-card {
            background-color: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            height: 100%;
        }
        .evaluation-card:hover { border-color: #D94686; transform: translateY(-2px); }
        .evaluation-card.selected { border-color: #D94686; background-color: #fce7f3; }
        .evaluation-card .score { font-size: 1.5rem; font-weight: 800; color: #D94686; }
        
        .opportunity-card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            margin-top: 1.5rem;
            overflow: hidden;
        }
        .opportunity-card-header {
            background-color: #2d2d2d; color: white; padding: 0.75rem 1.5rem;
            font-weight: bold; font-size: 1.25rem;
        }
        .opportunity-card-body {
            padding: 1.5rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;
        }
        .opportunity-card-body h4 {
            font-weight: bold; color: #D94686; margin-bottom: 0.5rem; display: flex; align-items: center;
        }
        .stat-number { font-size: 2.5rem; font-weight: 800; color: #2d2d2d; line-height: 1; }
        .stat-text { font-size: 0.875rem; margin-top: 0.25rem; }
        .source-text { font-size: 0.75rem; color: #6b7280; margin-top: 0.5rem; }
    </style>
</head>
<body>
    <div class="slide-container">
        <h2 class="slide-title">Outil de Diagnostic : Radar de Maturité Interactif</h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
            <div id="evaluation-grid" class="space-y-6"></div>
            <div class="sticky top-8">
                <div class="bg-slate-50 p-6 rounded-lg shadow-inner">
                    <div class="w-full max-w-md mx-auto">
                         <canvas id="radarChart"></canvas>
                    </div>
                    <div class="mt-6 text-center">
                         <button id="generate-button" class="devoteam-bg-accent-1 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-opacity-90 transition-transform transform hover:scale-105">
                            Générer les Pistes d'Optimisation
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div id="ai-results-container" class="mt-8">
            <div id="ai-pistes-section" class="hidden prose max-w-none p-6 bg-slate-50 rounded-lg shadow-inner">
                 <h3 id="pistes-title" class="text-xl font-bold text-center !m-0">Pistes d'Amélioration Prioritaires</h3>
                 <div id="loader-pistes" class="loader hidden"></div>
                 <div id="pistes-content"></div>
            </div>
            <div id="ai-details-section" class="hidden mt-6">
                <div id="loader-details" class="loader hidden"></div>
                <div id="details-content"></div>
            </div>
            <p id="error-message" class="text-red-600 mt-4 text-center font-semibold hidden"></p>
        </div>
    </div>

    <script>
        const evaluationData = {
            "1. Applicatif & Solutions": [{ score: 1, title: "Parc déséquilibré" }, { score: 2, title: "Peu optimisé" }, { score: 3, title: "En rationalisation" }, { score: 4, title: "Optimisé" }],
            "2. Licences & SaaS": [{ score: 1, title: "Surdimensionnées" }, { score: 2, title: "Suivi partiel" }, { score: 3, title: "Gestion proactive" }, { score: 4, title: "Optimisées" }],
            "3. Contrats IT": [{ score: 1, title: "Non renégociés" }, { score: 2, title: "Opportunistes" }, { score: 3, title: "Structurés" }, { score: 4, title: "Optimisés" }],
            "4. Ressources internes / externes": [{ score: 1, title: "Mal allouées" }, { score: 2, title: "Peu optimisées" }, { score: 3, title: "Rationalisées" }, { score: 4, title: "Flexibles" }],
            "5. Processus & IA": [{ score: 1, title: "Manuels" }, { score: 2, title: "Ponctuels" }, { score: 3, title: "Semi-automatisés" }, { score: 4, title: "IA-native" }],
            "6. Cloud & FinOps": [{ score: 1, title: "Non suivis" }, { score: 2, title: "Suivi partiel" }, { score: 3, title: "Actif" }, { score: 4, title: "Intégré" }],
            "7. Portefeuille projets & budgets": [{ score: 1, title: "Dispersés" }, { score: 2, title: "Pilotage basique" }, { score: 3, title: "ROI-first" }, { score: 4, title: "Dynamique" }],
            "8. Gouvernance & frugalité": [{ score: 1, title: "Faible" }, { score: 2, title: "Passive" }, { score: 3, title: "Active" }, { score: 4, title: "Intégrée" }]
        };

        const radarLabelsText = Object.keys(evaluationData);
        let currentScores = [3, 2, 1, 4, 1, 2, 1, 2];
        let radarChartInstance;

        const createEvaluationGrid = () => {
            const gridContainer = document.getElementById('evaluation-grid');
            gridContainer.innerHTML = radarLabelsText.map((axe, axeIndex) => `
                <div>
                    <h3 class="font-bold text-lg mb-2">${axe}</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        ${evaluationData[axe].map((option) => `
                            <div class="evaluation-card ${currentScores[axeIndex] === option.score ? 'selected' : ''}" data-axe-index="${axeIndex}" data-score="${option.score}">
                                <p class="score">${option.score}</p>
                                <p class="text-xs font-semibold mt-1">${option.title}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            document.querySelectorAll('.evaluation-card').forEach(card => {
                card.addEventListener('click', () => {
                    const axeIndex = parseInt(card.dataset.axeIndex);
                    const newScore = parseInt(card.dataset.score);
                    currentScores[axeIndex] = newScore;
                    const cardsForAxe = document.querySelectorAll(`.evaluation-card[data-axe-index="${axeIndex}"]`);
                    cardsForAxe.forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    updateRadarChart();
                });
            });
        };

        const updateRadarChart = () => { if (radarChartInstance) { radarChartInstance.data.datasets[0].data = currentScores; radarChartInstance.update(); } };

        const createRadarChart = () => {
            const shortLabels = radarLabelsText.map(label => label.split('.')[1].trim().split('&')[0].trim());
            const radarChartCtx = document.getElementById('radarChart').getContext('2d');
            radarChartInstance = new Chart(radarChartCtx, {
                type: 'radar',
                data: { labels: shortLabels, datasets: [{ label: 'Votre Score', data: currentScores, backgroundColor: 'rgba(217, 70, 134, 0.2)', borderColor: '#D94686', borderWidth: 2 }, { label: 'Benchmark Secteur Bancaire', data: [3.5, 3, 3, 4, 3, 3.5, 3, 3.5], backgroundColor: 'rgba(45, 45, 45, 0.1)', borderColor: '#2d2d2d', borderWidth: 2, borderDash: [5, 5] }] },
                options: { maintainAspectRatio: true, scales: { r: { suggestedMin: 0, suggestedMax: 4, pointLabels: { font: { size: 11 } }, ticks: { stepSize: 1 } } }, plugins: { legend: { position: 'bottom', labels: { boxWidth: 12 } } } }
            });
        };

        const fetchWithBackoff = async (url, options, retries = 3, delay = 1000) => {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return response.json();
                    if (response.status === 429 || response.status >= 500) { await new Promise(res => setTimeout(res, delay)); delay *= 2; } 
                    else { return response.json(); }
                } catch (error) { await new Promise(res => setTimeout(res, delay)); delay *= 2; }
            }
            throw new Error(`Failed to fetch after ${retries} retries.`);
        };
        
        async function getInitialPistes() {
            const pistesSection = document.getElementById('ai-pistes-section');
            const loader = document.getElementById('loader-pistes');
            const pistesContent = document.getElementById('pistes-content');
            const errorMessage = document.getElementById('error-message');

            pistesSection.classList.remove('hidden');
            loader.classList.remove('hidden');
            pistesContent.innerHTML = '';
            errorMessage.classList.add('hidden');
            document.getElementById('ai-details-section').classList.add('hidden');

            const apiKey = "AIzaSyCJGihKmQW5WxbGXdrWBhnfS_Sx9u2Y4Fc";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const scoresText = radarLabelsText.map((label, index) => `- ${label}: ${currentScores[index]}/4`).join('\n');
            const prompt = `Vous êtes un consultant expert Devoteam. Analysez ces scores de maturité IT d'une DSI bancaire:\n${scoresText}\nVotre mission est de générer un plan d'action initial. Identifiez les axes avec un score de 1 ou 2. Pour chaque axe identifié, générez une recommandation détaillée sous la forme suivante :\n<h3 class="clickable-axe" data-axe="${"Nom Exact de l'Axe"}">[Titre de la Recommandation]</h3><ul><li>[Action 1]</li><li>[Action 2]</li><li>[Action 3]</li></ul>\nLe titre de la recommandation doit être impactant et commencer par un verbe. Ne produisez QUE le code HTML des recommandations.`;
            
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            try {
                const result = await fetchWithBackoff(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                    pistesContent.innerHTML = result.candidates[0].content.parts[0].text;
                    document.querySelectorAll('.clickable-axe').forEach(item => {
                        item.addEventListener('click', () => getDetailedOpportunity(item.dataset.axe));
                    });
                } else {
                    errorMessage.textContent = "La réponse de l'IA est invalide. Veuillez réessayer.";
                    errorMessage.classList.remove('hidden');
                }
            } catch (error) {
                errorMessage.textContent = "Erreur de communication avec l'IA. Veuillez réessayer.";
                errorMessage.classList.remove('hidden');
            } finally {
                loader.classList.add('hidden');
            }
        }

        async function getDetailedOpportunity(axeName) {
            const detailsSection = document.getElementById('ai-details-section');
            const loader = document.getElementById('loader-details');
            const detailsContent = document.getElementById('details-content');
            const errorMessage = document.getElementById('error-message');

            detailsSection.classList.remove('hidden');
            loader.classList.remove('hidden');
            detailsContent.innerHTML = '';
            errorMessage.classList.add('hidden');
            
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const prompt = `Vous êtes un expert Devoteam. Créez une "Fiche d'Opportunité" pour l'axe "${axeName}" d'une DSI bancaire. Utilisez IMPÉRATIVEMENT le template HTML fourni. Remplissez les [CROCHETS] avec des chiffres et des sources crédibles (Gartner, McKinsey) et un REX Devoteam pertinent et anonymisé.\nTemplate HTML :\n<div class="opportunity-card"><div class="opportunity-card-header">Zoom sur : ${axeName}</div><div class="opportunity-card-body"><div><h4><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z" /></svg>L'Argument Clé (Benchmark)</h4><p class="stat-number">[Chiffre Clé Pertinent]</p><p class="stat-text">[Texte explicatif du benchmark].</p><p class="source-text">Source: [Nom de la source]</p></div><div><h4><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>La Preuve (REX Devoteam)</h4><p class="stat-number">[Chiffre Clé du REX]</p><p class="stat-text">[Texte explicatif du REX].</p></div></div></div>`;

            const payload = { contents: [{ parts: [{ text: prompt }] }] };

             try {
                const result = await fetchWithBackoff(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (result.candidates && result.candidates[0]?.content?.parts[0]?.text) {
                    detailsContent.innerHTML = result.candidates[0].content.parts[0].text;
                    detailsContent.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    errorMessage.textContent = "La réponse de l'IA est invalide. Veuillez réessayer.";
                    errorMessage.classList.remove('hidden');
                }
            } catch (error) {
                errorMessage.textContent = "Erreur de communication avec l'IA. Veuillez réessayer.";
                errorMessage.classList.remove('hidden');
            } finally {
                loader.classList.add('hidden');
            }
        }
        
        document.getElementById('generate-button').addEventListener('click', getInitialPistes);

        window.addEventListener('load', () => {
            createEvaluationGrid();
            createRadarChart();
        });
    </script>
</body>
</html>

